<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä Mapefill</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .content {
            padding: 20px;
        }

        .section {
            margin-bottom: 25px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .section h2 {
            font-size: 16px;
            margin-bottom: 15px;
            color: #333;
        }

        .type-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .type-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .type-btn.active {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .input-group.full {
            grid-template-columns: 1fr;
        }

        .input-field {
            display: flex;
            flex-direction: column;
        }

        .input-field label {
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 5px;
            color: #555;
        }

        .input-field input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .input-field input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .input-field input.hidden {
            display: none;
        }

        .hint {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 12px;
            border-radius: 6px;
            font-size: 13px;
            color: #856404;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-danger {
            background: #dc3545;
            color: white;
            font-size: 13px;
            margin-top: 10px;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }

        thead {
            background: #667eea;
            color: white;
        }

        th {
            padding: 12px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #eee;
            font-size: 13px;
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        tbody tr.selected {
            background: #e7f3ff;
        }

        .table-container {
            max-height: 400px;
            overflow-y: auto;
            border-radius: 6px;
            border: 1px solid #ddd;
        }

        .result-box {
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            border-left: 4px solid #667eea;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 10px;
        }

               .result-title {
            font-size: 13px;
            font-weight: 600;
            color: #555;
            margin-bottom: 5px;
        }

        .result-box.mapefill .result-title {
            color: #1565C0;
            font-weight: 700;
        }

        .result-box.sealant .result-title {
            color: #2E7D32;
            font-weight: 700;
        }

        .result-value {
            font-size: 18px;
            font-weight: 700;
            color: #667eea;
        }

        .result-box.mapefill .result-value {
            color: #1565C0;
        }

        .result-box.sealant .result-value {
            color: #2E7D32;
        }

        .result-value {
            font-size: 18px;
            font-weight: 700;
            color: #667eea;
        }

        .result-box.mapefill .result-value {
            color: #1565C0;
        }

        .result-box.sealant .result-value {
            color: #2E7D32;
        }

        .result-detail {
            font-size: 12px;
            color: #888;
            margin-top: 3px;
        }

        .empty-state {
            text-align: center;
            padding: 30px;
            color: #999;
            font-size: 14px;
        }

        @media (max-width: 600px) {
            .input-group {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 20px;
            }

            table {
                font-size: 12px;
            }

            th, td {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üßÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä Mapefill + SikaSwell S-2</h1>
        </div>

        <div class="content">
            <!-- –í–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö -->
            <div class="section">

                <div class="type-selector">
                    <button class="type-btn active" id="rectBtn" onclick="setType('rect')">–ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω–æ–µ</button>
                    <button class="type-btn" id="roundBtn" onclick="setType('round')">–ö—Ä—É–≥–ª–æ–µ</button>
                </div>

                <div class="hint">
                    ‚ùó <strong>–í–ù–ò–ú–ê–ù–ò–ï:</strong><br>
                    ‚Ä¢ –í—Å–µ —Ä–∞–∑–º–µ—Ä—ã –≤–≤–æ–¥–∏—Ç–µ –≤ <strong>–ú–ò–õ–õ–ò–ú–ï–¢–†–ê–• (–º–º)</strong>
                </div>

                <div class="input-group">
                    <div class="input-field">
                        <label for="length">–î–ª–∏–Ω–∞ (–º–º)</label>
                        <input type="number" id="length" placeholder="–í–≤–µ–¥–∏—Ç–µ –¥–ª–∏–Ω—É" step="0.1">
                    </div>
                    <div class="input-field">
                        <label for="width">–®–∏—Ä–∏–Ω–∞ (–º–º)</label>
                        <input type="number" id="width" placeholder="–í–≤–µ–¥–∏—Ç–µ —à–∏—Ä–∏–Ω—É" step="0.1">
                    </div>
                </div>

                <div class="input-group" id="rectGroup">
                    <div class="input-field">
                        <label for="height">–ì–ª—É–±–∏–Ω–∞ (–º–º)</label>
                        <input type="number" id="height" placeholder="–í–≤–µ–¥–∏—Ç–µ –≥–ª—É–±–∏–Ω—É" step="0.1">
                    </div>
                </div>

                <div class="input-group" id="roundGroup" style="display: none;">
                    <div class="input-field">
                        <label for="diameter">–î–∏–∞–º–µ—Ç—Ä (–º–º)</label>
                        <input type="number" id="diameter" placeholder="–í–≤–µ–¥–∏—Ç–µ –¥–∏–∞–º–µ—Ç—Ä" step="0.1">
                    </div>
                    <div class="input-field">
                        <label for="depth">–ì–ª—É–±–∏–Ω–∞ (–º–º)</label>
                        <input type="number" id="depth" placeholder="–í–≤–µ–¥–∏—Ç–µ –≥–ª—É–±–∏–Ω—É" step="0.1">
                    </div>
                </div>

                <div class="input-group full">
                    <div class="input-field">
                        <label for="count">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                        <input type="number" id="count" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ" min="1" step="1">
                    </div>
                </div>

                <button class="btn btn-primary" onclick="addHole()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ä—Å—Ç–∏–µ</button>
            </div>

            <!-- –¢–∞–±–ª–∏—Ü–∞ -->
            <div class="section">
                <h2>üìä –î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ä—Å—Ç–∏—è</h2>
                <div class="table-container" id="tableContainer">
                    <table id="holesTable">
                        <thead>
                            <tr>
                                <th>‚Ññ</th>
                                <th>–¢–∏–ø</th>
                                <th>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã (–º–º)</th>
                                <th>–ö–æ–ª-–≤–æ</th>
                                <th>–û–±—ä—ë–º (–º¬≥)</th>
                                <th>–ì–µ—Ä–º–µ—Ç–∏–∫ (–º.–ø.)</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="holesBody">
                            <tr><td colspan="7" class="empty-state">–û—Ç–≤–µ—Ä—Å—Ç–∏—è –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</td></tr>
                        </tbody>
                    </table>
                </div>
                <button class="btn btn-danger" onclick="deleteSelected()">üóë –£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω–æ–µ</button>
            </div>

            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
            <div class="section">
                <h2>üìà –†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å—á—ë—Ç–∞</h2>
                <div class="result-box mapefill">
                    <div class="result-title">–ê–Ω–∫–µ—Ä–Ω—ã–π –∑–∞–ø–æ–ª–Ω–∏—Ç–µ–ª—å Mapefill, 25 –∫–≥</div>
                    <div class="result-value" id="mapefillResult">0.00 –∫–≥ | 0 –º–µ—à–∫–æ–≤</div>
                    <div class="result-detail" id="mapefillDetail"></div>
                </div>
                <div class="result-box sealant">
                    <div class="result-title">–ì–µ—Ä–º–µ—Ç–∏–∫ SikaSwell S-2 –Ω–∞–±—É—Ö–∞—é—â–∏–π –∫—Ä–∞—Å–Ω—ã–π, 600 –º–ª</div>
                    <div class="result-value" id="sealantResult">0.00 –º.–ø. | 0 —Ç—É–±</div>
                    <div class="result-detail" id="sealantDetail"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const SEALANT_FACTOR = 0.204;
        let holes = [];
        let currentType = 'rect';
        let selectedRow = null;

        function setType(type) {
            currentType = type;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏
            document.getElementById('rectBtn').classList.remove('active');
            document.getElementById('roundBtn').classList.remove('active');
            
            if (type === 'rect') {
                document.getElementById('rectBtn').classList.add('active');
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—è –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞
                document.getElementById('length').parentElement.parentElement.style.display = 'grid';
                document.getElementById('width').parentElement.parentElement.style.display = 'grid';
                document.getElementById('rectGroup').style.display = 'grid';
                // –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª—è –∫—Ä—É–≥–∞
                document.getElementById('roundGroup').style.display = 'none';
            } else {
                document.getElementById('roundBtn').classList.add('active');
                // –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª—è –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞
                document.getElementById('length').parentElement.parentElement.style.display = 'none';
                document.getElementById('width').parentElement.parentElement.style.display = 'none';
                document.getElementById('rectGroup').style.display = 'none';
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—è –∫—Ä—É–≥–∞
                document.getElementById('roundGroup').style.display = 'grid';
            }
        }

        function ceilTo3(x) {
            return Math.ceil(x * 1000) / 1000;
        }

        function addHole() {
            try {
                let countVal = document.getElementById('count').value.trim();
                const count = countVal ? parseInt(countVal) : 1;
                if (count <= 0) throw new Error('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å > 0');

                let hole, paramsStr;

                if (currentType === 'round') {
                    const d_mm = parseFloat(document.getElementById('diameter').value);
                    const depth_mm = parseFloat(document.getElementById('depth').value);
                    if (!d_mm || !depth_mm || d_mm <= 0 || depth_mm <= 0) {
                        throw new Error('–î–∏–∞–º–µ—Ç—Ä –∏ –≥–ª—É–±–∏–Ω–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å > 0');
                    }
                    hole = {
                        type: 'round',
                        diameter_m: d_mm / 1000,
                        depth_m: depth_mm / 1000,
                        count: count
                    };
                    paramsStr = `√ò${d_mm.toFixed(0)}√ó${depth_mm.toFixed(0)} –º–º`;
                } else {
                    const l_mm = parseFloat(document.getElementById('length').value);
                    const w_mm = parseFloat(document.getElementById('width').value);
                    const h_mm = parseFloat(document.getElementById('height').value);
                    if (!l_mm || !w_mm || !h_mm || l_mm <= 0 || w_mm <= 0 || h_mm <= 0) {
                        throw new Error('–í—Å–µ —Ä–∞–∑–º–µ—Ä—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å > 0');
                    }
                    hole = {
                        type: 'rect',
                        length_m: l_mm / 1000,
                        width_m: w_mm / 1000,
                        height_m: h_mm / 1000,
                        count: count
                    };
                    paramsStr = `${l_mm.toFixed(0)}√ó${w_mm.toFixed(0)}√ó${h_mm.toFixed(0)} –º–º`;
                }

                // –†–∞—Å—á—ë—Ç –æ–±—ä—ë–º–∞
                let vol_one;
                if (hole.type === 'round') {
                    vol_one = Math.PI * Math.pow(hole.diameter_m / 2, 2) * hole.depth_m;
                } else {
                    vol_one = hole.length_m * hole.width_m * hole.height_m;
                }
                const vol_one_rounded = ceilTo3(vol_one);
                const total_vol = vol_one_rounded * hole.count;

                // –†–∞—Å—á—ë—Ç –≥–µ—Ä–º–µ—Ç–∏–∫–∞
                let perimeter;
                if (hole.type === 'round') {
                    perimeter = Math.PI * hole.diameter_m;
                } else {
                    perimeter = 2 * (hole.length_m + hole.width_m);
                }
                const total_sealant = (perimeter * hole.count).toFixed(2);

                holes.push(hole);
                renderTable();
                recalculate();
                clearInputs();
            } catch (e) {
                alert('–û—à–∏–±–∫–∞: ' + e.message);
            }
        }

        function clearInputs() {
            document.getElementById('length').value = '';
            document.getElementById('width').value = '';
            document.getElementById('height').value = '';
            document.getElementById('diameter').value = '';
            document.getElementById('depth').value = '';
            document.getElementById('count').value = '1';
        }

        function renderTable() {
            const tbody = document.getElementById('holesBody');
            if (holes.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="empty-state">–û—Ç–≤–µ—Ä—Å—Ç–∏—è –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</td></tr>';
                return;
            }

            tbody.innerHTML = holes.map((hole, idx) => {
                let paramsStr, vol_one;
                if (hole.type === 'round') {
                    paramsStr = `√ò${(hole.diameter_m * 1000).toFixed(0)}√ó${(hole.depth_m * 1000).toFixed(0)} –º–º`;
                    vol_one = Math.PI * Math.pow(hole.diameter_m / 2, 2) * hole.depth_m;
                } else {
                    paramsStr = `${(hole.length_m * 1000).toFixed(0)}√ó${(hole.width_m * 1000).toFixed(0)}√ó${(hole.height_m * 1000).toFixed(0)} –º–º`;
                    vol_one = hole.length_m * hole.width_m * hole.height_m;
                }
                const vol_rounded = ceilTo3(vol_one);
                const total_vol = vol_rounded * hole.count;

                let perimeter;
                if (hole.type === 'round') {
                    perimeter = Math.PI * hole.diameter_m;
                } else {
                    perimeter = 2 * (hole.length_m + hole.width_m);
                }
                const total_sealant = (perimeter * hole.count).toFixed(2);
                const holeType = hole.type === 'round' ? '–ö—Ä—É–≥–ª–æ–µ' : '–ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω–æ–µ';

                return `
                    <tr onclick="selectRow(${idx})">
                        <td>${idx + 1}</td>
                        <td>${holeType}</td>
                        <td>${paramsStr}</td>
                        <td>${hole.count}</td>
                        <td>${total_vol.toFixed(3)}</td>
                        <td>${total_sealant}</td>
                        <td><input type="checkbox" id="check_${idx}" onchange="selectRow(${idx})"></td>
                    </tr>
                `;
            }).join('');
        }

        function selectRow(idx) {
            selectedRow = idx;
        }

        function deleteSelected() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
            if (checkboxes.length === 0) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–æ–∫—É –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è');
                return;
            }
            const indices = Array.from(checkboxes).map(cb => parseInt(cb.id.split('_')[1])).sort((a, b) => b - a);
            indices.forEach(idx => {
                holes.splice(idx, 1);
            });
            renderTable();
            recalculate();
        }

        function recalculate() {
            if (holes.length === 0) {
                document.getElementById('mapefillResult').textContent = '0.00 –∫–≥ | 0 –º–µ—à–∫–æ–≤';
                document.getElementById('sealantResult').textContent = '0.00 –º.–ø. | 0 —Ç—É–±';
                document.getElementById('mapefillDetail').textContent = '';
                document.getElementById('sealantDetail').textContent = '';
                return;
            }

            let total_volume = 0;
            let total_perimeter = 0;

            holes.forEach(hole => {
                let vol_one;
                if (hole.type === 'round') {
                    vol_one = Math.PI * Math.pow(hole.diameter_m / 2, 2) * hole.depth_m;
                } else {
                    vol_one = hole.length_m * hole.width_m * hole.height_m;
                }
                const vol_rounded = ceilTo3(vol_one);
                total_volume += vol_rounded * hole.count;

                let perimeter;
                if (hole.type === 'round') {
                    perimeter = Math.PI * hole.diameter_m;
                } else {
                    perimeter = 2 * (hole.length_m + hole.width_m);
                }
                total_perimeter += perimeter * hole.count;
            });

            total_volume = ceilTo3(total_volume);
            const total_sealant_display = total_perimeter.toFixed(2);

            const mass = total_volume * 1900;
            const bags = Math.ceil(mass / 25);
            const sealant_packs = Math.ceil(total_perimeter * SEALANT_FACTOR);

            document.getElementById('mapefillResult').textContent = `${mass.toFixed(2)} –∫–≥ | ${bags} –º–µ—à–∫–æ–≤`;
            document.getElementById('mapefillDetail').textContent = `–û–±—ä—ë–º: ${total_volume.toFixed(3)} –º¬≥`;
            document.getElementById('sealantResult').textContent = `${total_sealant_display} –º.–ø. | ${sealant_packs} —Ç—É–±`;
            document.getElementById('sealantDetail').textContent = `–ü–µ—Ä–∏–º–µ—Ç—Ä: ${total_perimeter.toFixed(2)} –º`;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        renderTable();
        recalculate();
    </script>
</body>
</html>
