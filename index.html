<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä Mapefill</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }
        .content {
            padding: 20px;
        }
        .section {
            margin-bottom: 25px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        .section h2 {
            font-size: 16px;
            margin-bottom: 15px;
            color: #333;
        }
        .type-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .type-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }
        .type-btn.active {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }
        .input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        .input-group.full {
            grid-template-columns: 1fr;
        }
        .input-field {
            display: flex;
            flex-direction: column;
        }
        .input-field label {
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 5px;
            color: #555;
        }
        .input-field input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        .input-field input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .input-field input.hidden {
            display: none;
        }
        .hint {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 12px;
            border-radius: 6px;
            font-size: 13px;
            color: #856404;
            margin-bottom: 15px;
            line-height: 1.5;
        }
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
        }
        .btn-primary {
            background: #667eea;
            color: white;
        }
        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        .btn-primary:active {
            transform: translateY(0);
        }
        .btn-danger {
            background: #dc3545;
            color: white;
            font-size: 13px;
            margin-top: 10px;
        }
        .btn-danger:hover {
            background: #c82333;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }
        thead {
            background: #667eea;
            color: white;
        }
        th {
            padding: 12px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
        }
        td {
            padding: 12px;
            border-bottom: 1px solid #eee;
            font-size: 13px;
        }
        tbody tr:hover {
            background: #f8f9fa;
        }
        tbody tr.selected {
            background: #e7f3ff;
        }
        .table-container {
            max-height: 400px;
            overflow-y: auto;
            border-radius: 6px;
            border: 1px solid #ddd;
        }
        .result-box {
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            border-left: 4px solid #667eea;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 10px;
        }
        .result-box.mapefill {
            border-left-color: #1565C0;
            background: linear-gradient(135deg, #1565C015 0%, #1565C015 100%);
        }
        .result-box.sealant {
            border-left-color: #2E7D32;
            background: linear-gradient(135deg, #2E7D3215 0%, #2E7D3215 100%);
        }
        .result-title {
            font-size: 13px;
            font-weight: 600;
            color: #555;
            margin-bottom: 5px;
        }
        .result-box.mapefill .result-title {
            color: #1565C0;
            font-weight: 700;
        }
        .result-box.sealant .result-title {
            color: #2E7D32;
            font-weight: 700;
        }
        .result-value {
            font-size: 18px;
            font-weight: 700;
            color: #667eea;
        }
        .result-box.mapefill .result-value {
            color: #1565C0;
        }
        .result-box.sealant .result-value {
            color: #2E7D32;
        }
        .result-detail {
            font-size: 12px;
            color: #888;
            margin-top: 3px;
        }
        .empty-state {
            text-align: center;
            padding: 30px;
            color: #999;
            font-size: 14px;
        }
        @media print {
            body {
                background: white;
                padding: 0;
            }
            .container {
                box-shadow: none;
                max-width: 100%;
            }
            .section:first-child {
                display: none !important;
            }
            button {
                display: none !important;
            }
            .header {
                background: white;
                color: #667eea;
                border-bottom: 2px solid #667eea;
            }
            .highlight-bold {
                font-weight: bold !important;
            }
            table {
                border-collapse: collapse;
                width: 100%;
            }
            th, td {
                border: 1px solid #ddd;
                padding: 8px;
                text-align: left;
            }
            th {
                background-color: #f2f2f2;
            }
        }
        @media (max-width: 600px) {
            .input-group {
                grid-template-columns: 1fr;
            }
            .header h1 {
                font-size: 20px;
            }
            table {
                font-size: 12px;
            }
            th, td {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üßÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä Mapefill + SikaSwell S-2</h1>
        </div>
        <div class="content">
            <div class="section">
                <div class="type-selector">
                    <button class="type-btn active" id="rectBtn" onclick="setType('rect')">–ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω–æ–µ</button>
                    <button class="type-btn" id="roundBtn" onclick="setType('round')">–ö—Ä—É–≥–ª–æ–µ</button>
                </div>
                <div class="hint">
                    ‚ùó <strong>–í–ù–ò–ú–ê–ù–ò–ï:</strong><br>
                    ‚Ä¢ –í—Å–µ —Ä–∞–∑–º–µ—Ä—ã –≤–≤–æ–¥–∏—Ç–µ –≤ <strong>–ú–ò–õ–õ–ò–ú–ï–¢–†–ê–• (–º–º)</strong>
                </div>
                <div class="input-group">
                    <div class="input-field">
                        <label for="length">–î–ª–∏–Ω–∞ (–º–º)</label>
                        <input type="number" id="length" placeholder="–í–≤–µ–¥–∏—Ç–µ –¥–ª–∏–Ω—É" step="0.1" onkeypress="handleEnter(event, 'width')">
                    </div>
                    <div class="input-field">
                        <label for="width">–®–∏—Ä–∏–Ω–∞ (–º–º)</label>
                        <input type="number" id="width" placeholder="–í–≤–µ–¥–∏—Ç–µ —à–∏—Ä–∏–Ω—É" step="0.1" onkeypress="handleEnter(event, 'height')">
                    </div>
                </div>
                <div class="input-group" id="rectGroup">
                    <div class="input-field">
                        <label for="height">–ì–ª—É–±–∏–Ω–∞ (–º–º)</label>
                        <input type="number" id="height" placeholder="–í–≤–µ–¥–∏—Ç–µ –≥–ª—É–±–∏–Ω—É" step="0.1" onkeypress="handleEnter(event, 'count')">
                    </div>
                </div>
                <div class="input-group" id="roundGroup" style="display: none;">
                    <div class="input-field">
                        <label for="diameter">–î–∏–∞–º–µ—Ç—Ä (–º–º)</label>
                        <input type="number" id="diameter" placeholder="–í–≤–µ–¥–∏—Ç–µ –¥–∏–∞–º–µ—Ç—Ä" step="0.1" onkeypress="handleEnter(event, 'depth')">
                    </div>
                    <div class="input-field">
                        <label for="depth">–ì–ª—É–±–∏–Ω–∞ (–º–º)</label>
                        <input type="number" id="depth" placeholder="–í–≤–µ–¥–∏—Ç–µ –≥–ª—É–±–∏–Ω—É" step="0.1" onkeypress="handleEnter(event, 'count')">
                    </div>
                </div>
                <div class="input-group full">
                    <div class="input-field">
                        <label for="count">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                        <input type="number" id="count" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ" min="1" step="1" onkeypress="handleEnter(event, 'add')">
                    </div>
                </div>
                <button class="btn btn-primary" id="addBtn" onclick="addHole()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ä—Å—Ç–∏–µ</button>
            </div>
            <div class="section">
                <h2 class="highlight-bold">üìä –î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ä—Å—Ç–∏—è</h2>
                <div class="table-container" id="tableContainer">
                    <table id="holesTable">
                        <thead>
                            <tr>
                                <th class="highlight-bold">‚Ññ</th>
                                <th class="highlight-bold">–¢–∏–ø</th>
                                <th class="highlight-bold">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã (–º–º)</th>
                                <th class="highlight-bold">–ö–æ–ª-–≤–æ</th>
                                <th class="highlight-bold">–û–±—ä—ë–º (–º¬≥)</th>
                                <th class="highlight-bold">–ì–µ—Ä–º–µ—Ç–∏–∫ (–º.–ø.)</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="holesBody">
                            <tr><td colspan="7" class="empty-state">–û—Ç–≤–µ—Ä—Å—Ç–∏—è –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</td></tr>
                        </tbody>
                    </table>
                </div>
                <button class="btn btn-danger" onclick="deleteSelected()">üóë –£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω–æ–µ</button>
            </div>
            <div class="section">
                <h2 class="highlight-bold">üìà –†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å—á—ë—Ç–∞</h2>
                <div class="result-box" style="background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%); border-left-color: #667eea;">
                    <div class="result-title highlight-bold" style="color: #667eea; font-weight: 700;">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ä—Å—Ç–∏–π</div>
                    <div class="result-value highlight-bold" style="color: #667eea;" id="holesCount">0 —à—Ç</div>
                </div>
                <div class="result-box mapefill">
                    <div class="result-title highlight-bold">–ê–Ω–∫–µ—Ä–Ω—ã–π –∑–∞–ø–æ–ª–Ω–∏—Ç–µ–ª—å Mapefill, 25 –∫–≥</div>
                    <div class="result-value highlight-bold" id="mapefillResult">0.00 –∫–≥ | 0 –º–µ—à–∫–æ–≤</div>
                    <div class="result-detail highlight-bold" id="mapefillDetail"></div>
                </div>
                <div class="result-box sealant">
                    <div class="result-title highlight-bold">–ì–µ—Ä–º–µ—Ç–∏–∫ SikaSwell S-2 –Ω–∞–±—É—Ö–∞—é—â–∏–π –∫—Ä–∞—Å–Ω—ã–π, 600 –º–ª</div>
                    <div class="result-value highlight-bold" id="sealantResult">0.00 –º.–ø. | 0 —Ç—É–±</div>
                    <div class="result-detail highlight-bold" id="sealantDetail"></div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 15px;">
                    <button class="btn btn-primary" onclick="downloadPDF()" style="background: #28a745;">üìÑ –ü–µ—á–∞—Ç—å</button>
                    <button class="btn btn-primary" onclick="copyResults()" style="background: #17a2b8;">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                    <button class="btn btn-primary" onclick="exportToExcel()" style="background: #217346;">üìä Excel</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        const SEALANT_FACTOR = 0.204;
        let holes = [];
        let currentType = 'rect';
        let selectedRow = null;
        let totalHolesCount = 0;

        function setType(type) {
            currentType = type;
            document.getElementById('rectBtn').classList.remove('active');
            document.getElementById('roundBtn').classList.remove('active');

            if (type === 'rect') {
                document.getElementById('rectBtn').classList.add('active');
                document.getElementById('length').parentElement.parentElement.style.display = 'grid';
                document.getElementById('width').parentElement.parentElement.style.display = 'grid';
                document.getElementById('rectGroup').style.display = 'grid';
                document.getElementById('roundGroup').style.display = 'none';
                setTimeout(() => document.getElementById('length').focus(), 100);
            } else {
                document.getElementById('roundBtn').classList.add('active');
                document.getElementById('length').parentElement.parentElement.style.display = 'none';
                document.getElementById('width').parentElement.parentElement.style.display = 'none';
                document.getElementById('rectGroup').style.display = 'none';
                document.getElementById('roundGroup').style.display = 'grid';
                setTimeout(() => document.getElementById('diameter').focus(), 100);
            }
        }

        function handleEnter(event, nextField) {
            if (event.key === 'Enter') {
                event.preventDefault();
                if (nextField === 'add') {
                    addHole();
                    if (currentType === 'rect') {
                        setTimeout(() => document.getElementById('length').focus(), 100);
                    } else {
                        setTimeout(() => document.getElementById('diameter').focus(), 100);
                    }
                } else {
                    const element = document.getElementById(nextField);
                    if (element) {
                        element.focus();
                    }
                }
            }
        }

        function ceilTo3(x) {
            return Math.ceil(x * 1000) / 1000;
        }

        function addHole() {
            try {
                let countVal = document.getElementById('count').value.trim();
                if (!countVal) {
                    throw new Error('–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ');
                }
                const count = parseInt(countVal);
                if (count <= 0) throw new Error('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å > 0');
                let hole, paramsStr;
                if (currentType === 'round') {
                    const d_mm = parseFloat(document.getElementById('diameter').value);
                    const depth_mm = parseFloat(document.getElementById('depth').value);
                    if (!d_mm || !depth_mm || d_mm <= 0 || depth_mm <= 0) {
                        throw new Error('–î–∏–∞–º–µ—Ç—Ä –∏ –≥–ª—É–±–∏–Ω–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å > 0');
                    }
                    hole = {
                        type: 'round',
                        diameter_m: d_mm / 1000,
                        depth_m: depth_mm / 1000,
                        count: count
                    };
                } else {
                    const l_mm = parseFloat(document.getElementById('length').value);
                    const w_mm = parseFloat(document.getElementById('width').value);
                    const h_mm = parseFloat(document.getElementById('height').value);
                    if (!l_mm || !w_mm || !h_mm || l_mm <= 0 || w_mm <= 0 || h_mm <= 0) {
                        throw new Error('–í—Å–µ —Ä–∞–∑–º–µ—Ä—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å > 0');
                    }
                    hole = {
                        type: 'rect',
                        length_m: l_mm / 1000,
                        width_m: w_mm / 1000,
                        height_m: h_mm / 1000,
                        count: count
                    };
                }
                totalHolesCount += count;
                holes.push(hole);
                renderTable();
                recalculate();
                clearInputs();
            } catch (e) {
                alert('–û—à–∏–±–∫–∞: ' + e.message);
            }
        }

        function clearInputs() {
            document.getElementById('length').value = '';
            document.getElementById('width').value = '';
            document.getElementById('height').value = '';
            document.getElementById('diameter').value = '';
            document.getElementById('depth').value = '';
            document.getElementById('count').value = '';
        }

        function renderTable() {
            const tbody = document.getElementById('holesBody');
            if (holes.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="empty-state">–û—Ç–≤–µ—Ä—Å—Ç–∏—è –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</td></tr>';
                return;
            }
            tbody.innerHTML = holes.map((hole, idx) => {
                let paramsStr, vol_one;
                if (hole.type === 'round') {
                    paramsStr = '√ò' + (hole.diameter_m * 1000).toFixed(0) + '√ó' + (hole.depth_m * 1000).toFixed(0) + ' –º–º';
                    vol_one = Math.PI * Math.pow(hole.diameter_m / 2, 2) * hole.depth_m;
                } else {
                    paramsStr = (hole.length_m * 1000).toFixed(0) + '√ó' + (hole.width_m * 1000).toFixed(0) + '√ó' + (hole.height_m * 1000).toFixed(0) + ' –º–º';
                    vol_one = hole.length_m * hole.width_m * hole.height_m;
                }
                const vol_rounded = ceilTo3(vol_one);
                const total_vol = vol_rounded * hole.count;
                let perimeter;
                if (hole.type === 'round') {
                    perimeter = Math.PI * hole.diameter_m;
                } else {
                    perimeter = 2 * (hole.length_m + hole.width_m);
                }
                const total_sealant = (perimeter * hole.count).toFixed(2);
                const holeType = hole.type === 'round' ? '–ö—Ä—É–≥–ª–æ–µ' : '–ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω–æ–µ';
                return '<tr onclick="selectRow(' + idx + ')"><td>' + (idx + 1) + '</td><td>' + holeType + '</td><td>' + paramsStr + '</td><td>' + hole.count + '</td><td>' + total_vol.toFixed(3) + '</td><td>' + total_sealant + '</td><td><input type="checkbox" id="check_' + idx + '" onchange="selectRow(' + idx + ')"></td></tr>';
            }).join('');
        }

        function selectRow(idx) {
            selectedRow = idx;
        }

        function deleteSelected() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
            if (checkboxes.length === 0) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–æ–∫—É –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è');
                return;
            }
            const indices = Array.from(checkboxes).map(cb => parseInt(cb.id.split('_')[1])).sort((a, b) => b - a);

            indices.forEach(idx => {
                totalHolesCount -= holes[idx].count;
                holes.splice(idx, 1);
            });

            renderTable();
            recalculate();
        }

        function recalculate() {
            document.getElementById('holesCount').textContent = totalHolesCount + ' —à—Ç';
            if (holes.length === 0) {
                totalHolesCount = 0;
                document.getElementById('holesCount').textContent = '0 —à—Ç';
                document.getElementById('mapefillResult').textContent = '0.00 –∫–≥ | 0 –º–µ—à–∫–æ–≤';
                document.getElementById('sealantResult').textContent = '0.00 –º.–ø. | 0 —Ç—É–±';
                document.getElementById('mapefillDetail').textContent = '';
                document.getElementById('sealantDetail').textContent = '';
                return;
            }
            let total_volume = 0;
            let total_perimeter = 0;
            holes.forEach(h => {
                let vol_one;
                if (h.type === 'round') {
                    vol_one = Math.PI * Math.pow(h.diameter_m / 2, 2) * h.depth_m;
                } else {
                    vol_one = h.length_m * h.width_m * h.height_m;
                }
                const vol_rounded = ceilTo3(vol_one);
                total_volume += vol_rounded * h.count;
                let perimeter;
                if (h.type === 'round') {
                    perimeter = Math.PI * h.diameter_m;
                } else {
                    perimeter = 2 * (h.length_m + h.width_m);
                }
                total_perimeter += perimeter * h.count;
            });
            const total_sealant_display = total_perimeter.toFixed(2);
            const sealant_packs = Math.ceil(total_perimeter * SEALANT_FACTOR);
            const mass = Math.ceil(total_volume * 1900.0 * 0.88);
            const bags = Math.ceil(mass / 25.0);
            document.getElementById('mapefillResult').textContent = mass + ' –∫–≥ | ' + bags + ' –º–µ—à–∫–æ–≤';
            document.getElementById('mapefillDetail').textContent = '–û–±—ä—ë–º: ' + total_volume.toFixed(3) + ' –º¬≥';
            document.getElementById('sealantResult').textContent = total_sealant_display + ' –º.–ø. | ' + sealant_packs + ' —Ç—É–±(-—ã)';
            document.getElementById('sealantDetail').textContent = '–ü–µ—Ä–∏–º–µ—Ç—Ä: ' + total_perimeter.toFixed(2) + ' –º';
        }

        function copyResults() {
            if (holes.length === 0) {
                alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è. –î–æ–±–∞–≤—å—Ç–µ –æ—Ç–≤–µ—Ä—Å—Ç–∏—è.');
                return;
            }
            let text = 'üßÆ –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–† MAPEFILL - –†–ï–ó–£–õ–¨–¢–ê–¢–´\n';
            text += '==================================================\n\n';
            text += 'üìä –û–¢–í–ï–†–°–¢–ò–Ø:\n';

            holes.forEach((hole, idx) => {
                let params;
                if (hole.type === 'round') {
                    params = '√ò' + (hole.diameter_m * 1000).toFixed(0) + '√ó' + (hole.depth_m * 1000).toFixed(0) + ' –º–º';
                } else {
                    params = (hole.length_m * 1000).toFixed(0) + '√ó' + (hole.width_m * 1000).toFixed(0) + '√ó' + (hole.height_m * 1000).toFixed(0) + ' –º–º';
                }
                const type = hole.type === 'round' ? '–ö—Ä—É–≥–ª–æ–µ' : '–ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω–æ–µ';
                text += (idx + 1) + '. ' + type + ' ' + params + ' ‚Äî ' + hole.count + ' —à—Ç\n';
            });

            text += '\n==================================================\n';
            text += 'üìà –ò–¢–û–ì–û–í–´–ô –†–ê–°–ß–Å–¢:\n\n';
            text += '‚Ä¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ä—Å—Ç–∏–π: ' + totalHolesCount + ' —à—Ç\n';
            text += '‚Ä¢ ' + document.getElementById('mapefillResult').textContent + '\n';
            text += '‚Ä¢ ' + document.getElementById('sealantResult').textContent + '\n';
            text += '\n==================================================\n';
            text += '–î–∞—Ç–∞: ' + new Date().toLocaleString('ru-RU');
            navigator.clipboard.writeText(text).then(() => {
                alert('‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
            }).catch(() => {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã!');
            });
        }

        function downloadPDF() {
            if (holes.length === 0) {
                alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è. –î–æ–±–∞–≤—å—Ç–µ –æ—Ç–≤–µ—Ä—Å—Ç–∏—è.');
                return;
            }
            window.print();
        }

function exportToExcel() {
    if (holes.length === 0) {
        alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞. –î–æ–±–∞–≤—å—Ç–µ –æ—Ç–≤–µ—Ä—Å—Ç–∏—è.');
        return;
    }

    const wb = XLSX.utils.book_new();
    const ws = XLSX.utils.aoa_to_sheet([]);

    // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞
    XLSX.utils.sheet_add_aoa(ws, [
        ["=== –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–† MAPEFILL + SIKASWELL S-2 ==="],
        ["–î–∞—Ç–∞ —Ä–∞—Å—á—ë—Ç–∞:", new Date().toLocaleString('ru-RU')],
        [],
        ["=== –î–û–ë–ê–í–õ–ï–ù–ù–´–ï –û–¢–í–ï–†–°–¢–ò–Ø ==="]
    ], { origin: "A1" });

    // –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ã
    XLSX.utils.sheet_add_aoa(ws, [
        ["‚Ññ", "–¢–∏–ø –æ—Ç–≤–µ—Ä—Å—Ç–∏—è", "–ü–∞—Ä–∞–º–µ—Ç—Ä—ã (–º–º)", "–ö–æ–ª-–≤–æ (—à—Ç)", "–û–±—ä—ë–º (–º¬≥)", "–ì–µ—Ä–º–µ—Ç–∏–∫ (–º.–ø.)"]
    ], { origin: "A5" });

    // –î–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
    holes.forEach((hole, idx) => {
        let params, vol_one;
        if (hole.type === 'round') {
            params = '√ò' + (hole.diameter_m * 1000).toFixed(0) + ' √ó ' + (hole.depth_m * 1000).toFixed(0) + ' –º–º';
            vol_one = Math.PI * Math.pow(hole.diameter_m / 2, 2) * hole.depth_m;
        } else {
            params = (hole.length_m * 1000).toFixed(0) + ' √ó ' + (hole.width_m * 1000).toFixed(0) + ' √ó ' + (hole.height_m * 1000).toFixed(0) + ' –º–º';
            vol_one = hole.length_m * hole.width_m * hole.height_m;
        }
        const vol_rounded = ceilTo3(vol_one);
        const total_vol = vol_rounded * hole.count;
        let perimeter;
        if (hole.type === 'round') {
            perimeter = Math.PI * hole.diameter_m;
        } else {
            perimeter = 2 * (hole.length_m + hole.width_m);
        }
        const total_sealant = (perimeter * hole.count).toFixed(2);
        const type = hole.type === 'round' ? '–ö—Ä—É–≥–ª–æ–µ' : '–ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω–æ–µ';

        XLSX.utils.sheet_add_aoa(ws, [
            [idx + 1, type, params, hole.count, total_vol.toFixed(3), total_sealant]
        ], { origin: -1 });
    });

    // –ò—Ç–æ–≥–æ–≤—ã–π —Ä–∞—Å—á—ë—Ç
    XLSX.utils.sheet_add_aoa(ws, [
        [],
        ["=== –ò–¢–û–ì–û–í–´–ô –†–ê–°–ß–Å–¢ ==="],
        ["–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å", "–ó–Ω–∞—á–µ–Ω–∏–µ"],
        ["–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ä—Å—Ç–∏–π (—à—Ç)", totalHolesCount],
        [],
        ["–ê–Ω–∫–µ—Ä–Ω—ã–π –∑–∞–ø–æ–ª–Ω–∏—Ç–µ–ª—å Mapefill, 25 –∫–≥ (–∫–≥)", document.getElementById('mapefillResult').textContent.split('|')[0].trim()],
        ["–ê–Ω–∫–µ—Ä–Ω—ã–π –∑–∞–ø–æ–ª–Ω–∏—Ç–µ–ª—å Mapefill, 25 –∫–≥ (–º–µ—à–∫–æ–≤)", document.getElementById('mapefillResult').textContent.split('|')[1].trim()],
        [],
        ["–ì–µ—Ä–º–µ—Ç–∏–∫ SikaSwell S-2, 600 –º–ª (—Ç—É–±(-—ã))", document.getElementById('sealantResult').textContent.split('|')[1].trim()],
        [],
        ["–î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û"],
        ["–û–±—â–∏–π –æ–±—ä—ë–º (–º¬≥)", document.getElementById('mapefillDetail').textContent.replace('–û–±—ä—ë–º: ', '')],
        ["–û–±—â–∏–π –ø–µ—Ä–∏–º–µ—Ç—Ä (–º)", document.getElementById('sealantDetail').textContent.replace('–ü–µ—Ä–∏–º–µ—Ç—Ä: ', '')]
    ], { origin: -1 });

    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∫–∞–∂–¥–æ–π —è—á–µ–π–∫–∏
    const range = XLSX.utils.decode_range(ws['!ref']);
    for (let R = range.s.r; R <= range.e.r; ++R) {
        for (let C = range.s.c; C <= range.e.c; ++C) {
            const cellAddress = XLSX.utils.encode_cell({ r: R, c: C });
            if (!ws[cellAddress]) continue;

            // –°—Ç–∏–ª–∏ –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
            if (R === 0 || R === 4 || R === 7 || R === 11) {
                ws[cellAddress].s = {
                    font: { bold: true, sz: 12 },
                    alignment: { horizontal: "center", vertical: "center" },
                    fill: { fgColor: { rgb: "B7DEE8" } }
                };
            }

            // –°—Ç–∏–ª–∏ –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ —Ç–∞–±–ª–∏—Ü—ã
            if (R === 4) {
                ws[cellAddress].s = {
                    font: { bold: true, sz: 12 },
                    alignment: { horizontal: "center", vertical: "center" },
                    fill: { fgColor: { rgb: "B7DEE8" } }
                };
            }

            // –°—Ç–∏–ª–∏ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü—ã
            if (R >= 5 && R <= 5 + holes.length) {
                if (!ws[cellAddress].s) ws[cellAddress].s = {};
                ws[cellAddress].s.border = {
                    top: { style: "thin" },
                    left: { style: "thin" },
                    bottom: { style: "thin" },
                    right: { style: "thin" }
                };
                if (R % 2 === 0) {
                    ws[cellAddress].s.fill = { fgColor: { rgb: "E7F5FF" } };
                } else {
                    ws[cellAddress].s.fill = { fgColor: { rgb: "FFFFFF" } };
                }
            }

            // –°—Ç–∏–ª–∏ –¥–ª—è –∏—Ç–æ–≥–æ–≤—ã—Ö —Å—Ç—Ä–æ–∫
            if (R === 8 || R === 9 || R === 10 || R === 13 || R === 14) {
                ws[cellAddress].s = {
                    font: { bold: true, sz: 12 },
                    alignment: { horizontal: "center", vertical: "center" }
                };
            }
        }
    }

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —à–∏—Ä–∏–Ω—ã —Å—Ç–æ–ª–±—Ü–æ–≤
    ws['!cols'] = [
        { wch: 45 },   // ‚Ññ
        { wch: 15 },  // –¢–∏–ø –æ—Ç–≤–µ—Ä—Å—Ç–∏—è
        { wch: 25 },  // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã (–º–º)
        { wch: 10 },  // –ö–æ–ª-–≤–æ (—à—Ç)
        { wch: 15 },  // –û–±—ä—ë–º (–º¬≥)
        { wch: 15 }   // –ì–µ—Ä–º–µ—Ç–∏–∫ (–º.–ø.)
    ];

    // –î–æ–±–∞–≤–ª—è–µ–º –ª–∏—Å—Ç –≤ –∫–Ω–∏–≥—É
    XLSX.utils.book_append_sheet(wb, ws, "–†–∞—Å—á—ë—Ç");

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª
    XLSX.writeFile(wb, 'Mapefill_—Ä–∞—Å—á—ë—Ç_' + new Date().toISOString().split('T')[0] + '.xlsx');
}

        renderTable();
        recalculate();
    </script>
</body>
</html>
